<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>模型训练界面</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_app.css') }}">
</head>

<body>
    <div class="main-content" style="position:relative;min-height:600px;">
        <div class="left-preview">
            <div class="audio-box" style="margin-bottom: 12px;">
                <audio id="previewAudio" class="preview-audio" controls autoplay style="width:100%;"></audio>
            </div>
            <div class="video-box">
                <video id="previewVideo" class="preview-video" controls autoplay muted loop style="width:100%; height:auto; background:#000;"
                    src="{{ request.form.get('video_path', 'static/videos/Trump.mp4') }}">
                </video>
            </div>
        </div>

        <div class="right-form">
            <form method="POST">
                <div class="form-group">
                    <label>模型名称</label>
                    <select name="model_name">
                        <option>SyncTalk</option>
                        <option>Model A</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>参考视频地址</label>
                    <input type="text" name="video_path" value="static/videos/Trump.mp4">
                </div>

                <div class="form-group">
                    <label>GPU选择</label>
                    <select name="gpu">
                        <option>GPU 0</option>
                        <option>GPU 1</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Epoch (训练轮数)</label>
                    <input type="number" name="epoch" value="10">
                </div>

                <div class="form-group">
                    <label>自定义训练参数</label>
                    <input type="text" placeholder="请输入自定义参数...">
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="submit-btn">Train</button>
                </div>
                <div id="trainStatus" style="margin-top:18px;color:#1976d2;font-weight:bold;"></div>
                </div>
            </form>
        </div>
    </div>
</body>
</body>
<script>
    // 拦截表单提交，点击Training按钮时只更新视频并提示训练中，不跳转
    (function() {
        const form = document.querySelector('.right-form form');
        const videoInput = document.querySelector('input[name="video_path"]');
        const video = document.getElementById('previewVideo');
        const trainStatus = document.getElementById('trainStatus');
        if (form && videoInput && video && trainStatus) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                video.src = videoInput.value;
                video.load();
                const playPromise = video.play();
                if (playPromise && typeof playPromise.then === 'function') {
                    playPromise.catch(() => {/* ignore autoplay restrictions */});
                }
                trainStatus.textContent = '训练中...';
            });
        }
    })();
</script>

</html>